{% load static %}

<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF Preview</title>
<link rel="stylesheet" href="{% static 'documents/view.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<header class="header">
    <img src="{% static 'img/logo.png' %}" alt="Logo" class="logo">
    <div class="header-texts">
        <h1>Ijro intizomi</h1>
        <p>Idoralar yagona elektron tizimi</p>
    </div>
</header>

<div class="control-panel">
    <button id="zoom-in"><i class="fas fa-search-plus"></i></button>
    <button id="zoom-out"><i class="fas fa-search-minus"></i></button>
    <button id="rotate-cw"><i class="fas fa-rotate-right"></i></button>
    <button id="rotate-ccw"><i class="fas fa-rotate-left"></i></button>
    {% if pdf_preview %}
        <a href="{{ pdf_preview }}" download class="download-btn">
            <i class="fas fa-download"></i> Yuklab olish
        </a>
    {% endif %}
</div>

<div class="doc-con">
    {% if pdf_preview %}
        <img id="pdf-img" src="{{ pdf_preview }}" style="transform: rotate(0deg); max-width: 100%;">
    {% else %}
        <div class="no-preview">
            <p>PDF rasm mavjud emas</p>
            {% if doc and doc.pdf_image %}
                <p>Field mavjud: {{ doc.pdf_image }}</p>
                <p>URL: {{ doc.pdf_image.url }}</p>
            {% endif %}
        </div>
    {% endif %}
</div>

<script>
{% if pdf_preview %}
const img = document.getElementById('pdf-img');

let scale = 1;
let rotation = 0;

let translateX = 0;
let translateY = 0;

let isDragging = false;
let startX = 0;
let startY = 0;
let rafId = null;

function applyTransform() {
    img.style.transform =
        `translate3d(${translateX}px, ${translateY}px, 0) scale(${scale}) rotate(${rotation}deg)`;
    rafId = null;
}

function requestUpdate() {
    if (rafId) return;
    rafId = requestAnimationFrame(applyTransform);
}

document.getElementById('zoom-in').onclick = () => {
    scale += 0.1;
    requestUpdate();
};

document.getElementById('zoom-out').onclick = () => {
    scale = Math.max(0.1, scale - 0.1);
    requestUpdate();
};

document.getElementById('rotate-cw').onclick = () => {
    rotation += 90;
    requestUpdate();
};

document.getElementById('rotate-ccw').onclick = () => {
    rotation -= 90;
    requestUpdate();
};

img.addEventListener('dragstart', e => e.preventDefault());

img.addEventListener('mousedown', (e) => {
    isDragging = true;
    startX = e.clientX - translateX;
    startY = e.clientY - translateY;
    img.style.cursor = 'grabbing';
});

document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    translateX = e.clientX - startX;
    translateY = e.clientY - startY;
    requestUpdate();
});

document.addEventListener('mouseup', () => {
    isDragging = false;
    img.style.cursor = 'grab';
});
{% endif %}
</script>


</body>
</html>